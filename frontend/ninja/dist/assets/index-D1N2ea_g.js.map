{"version":3,"file":"index-D1N2ea_g.js","sources":["../../src/router.ts","../../src/api/client.ts","../../src/state.ts","../../src/pages/login.ts","../../src/components/navbar.ts","../../src/pages/dashboard.ts","../../src/pages/shop.ts","../../src/pages/leaderboard.ts","../../src/main.ts"],"sourcesContent":["type RouteHandler = (params?: Record<string, string>) => void | Promise<void>;\n\ninterface Route {\n  pattern: RegExp;\n  handler: RouteHandler;\n  paramNames: string[];\n}\n\nconst routes: Route[] = [];\n\nexport function route(path: string, handler: RouteHandler) {\n  // Convert path pattern to regex, extracting param names\n  const paramNames: string[] = [];\n  const pattern = path.replace(/:([^/]+)/g, (_match, paramName) => {\n    paramNames.push(paramName);\n    return '([^/]+)';\n  });\n  routes.push({\n    pattern: new RegExp(`^${pattern}$`),\n    handler,\n    paramNames,\n  });\n}\n\nexport function navigate(path: string) {\n  window.location.hash = path;\n}\n\nfunction handleRoute() {\n  const hash = window.location.hash.slice(1) || '/';\n\n  for (const { pattern, handler, paramNames } of routes) {\n    const match = hash.match(pattern);\n    if (match) {\n      const params: Record<string, string> = {};\n      paramNames.forEach((name, index) => {\n        params[name] = match[index + 1];\n      });\n      handler(params);\n      return;\n    }\n  }\n\n  // Default to root if no match\n  const rootRoute = routes.find(r => r.pattern.test('/'));\n  if (rootRoute) {\n    rootRoute.handler({});\n  }\n}\n\nexport function initRouter() {\n  window.addEventListener('hashchange', handleRoute);\n  window.addEventListener('load', handleRoute);\n  // Handle initial load\n  handleRoute();\n}\n","import type { ApiResponse } from '../types';\n\nconst BASE_URL = '/api';\n\nexport async function get<T>(url: string): Promise<ApiResponse<T>> {\n  try {\n    const response = await fetch(`${BASE_URL}${url}`);\n    if (!response.ok) {\n      const errorText = await response.text();\n      return { error: errorText || `HTTP ${response.status}` };\n    }\n    const data = await response.json();\n    return { data };\n  } catch (error) {\n    return { error: String(error) };\n  }\n}\n\nexport async function post<T>(url: string, body: unknown): Promise<ApiResponse<T>> {\n  try {\n    const response = await fetch(`${BASE_URL}${url}`, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(body),\n    });\n    if (!response.ok) {\n      const errorText = await response.text();\n      return { error: errorText || `HTTP ${response.status}` };\n    }\n    const data = await response.json();\n    return { data };\n  } catch (error) {\n    return { error: String(error) };\n  }\n}\n\nexport async function put<T>(url: string, body?: unknown): Promise<ApiResponse<T>> {\n  try {\n    const response = await fetch(`${BASE_URL}${url}`, {\n      method: 'PUT',\n      headers: { 'Content-Type': 'application/json' },\n      body: body ? JSON.stringify(body) : undefined,\n    });\n    if (!response.ok) {\n      const errorText = await response.text();\n      return { error: errorText || `HTTP ${response.status}` };\n    }\n    const data = await response.json();\n    return { data };\n  } catch (error) {\n    return { error: String(error) };\n  }\n}\n\nexport async function del<T>(url: string): Promise<ApiResponse<T>> {\n  try {\n    const response = await fetch(`${BASE_URL}${url}`, {\n      method: 'DELETE',\n    });\n    if (!response.ok) {\n      const errorText = await response.text();\n      return { error: errorText || `HTTP ${response.status}` };\n    }\n    if (response.status === 204) {\n      return { data: undefined as T };\n    }\n    const data = await response.json();\n    return { data };\n  } catch (error) {\n    return { error: String(error) };\n  }\n}\n","import type { AppState, Ninja } from './types';\n\nfunction loadNinja(): Ninja | null {\n  const raw = sessionStorage.getItem('currentNinja');\n  if (!raw) return null;\n  try {\n    return JSON.parse(raw) as Ninja;\n  } catch {\n    return null;\n  }\n}\n\nconst state: AppState = {\n  facilityId: sessionStorage.getItem('facilityId') || 'fcd4728c-afff-4a3c-8a39-05d2cd9d87ac', // Default facility\n  studentId: sessionStorage.getItem('studentId'),\n  currentNinja: loadNinja(),\n};\n\nexport function getState(): AppState {\n  return state;\n}\n\nexport function setState(updates: Partial<AppState>) {\n  Object.assign(state, updates);\n  if (updates.facilityId !== undefined) {\n    sessionStorage.setItem('facilityId', updates.facilityId);\n  }\n  if (updates.studentId !== undefined) {\n    if (updates.studentId) {\n      sessionStorage.setItem('studentId', updates.studentId);\n    } else {\n      sessionStorage.removeItem('studentId');\n    }\n  }\n}\n\nexport function setCurrentNinja(ninja: Ninja | null) {\n  state.currentNinja = ninja;\n  if (ninja) {\n    sessionStorage.setItem('currentNinja', JSON.stringify(ninja));\n  } else {\n    sessionStorage.removeItem('currentNinja');\n  }\n}\n\nexport function logout() {\n  setState({ studentId: null, currentNinja: null });\n}\n\nexport function isLoggedIn(): boolean {\n  return state.studentId !== null;\n}\n","import { post } from '../api/client';\nimport { setState, setCurrentNinja } from '../state';\nimport { navigate } from '../router';\nimport type { Ninja } from '../types';\n\nfunction decodeJwt(token: string): Record<string, unknown> | null {\n  try {\n    const parts = token.split('.');\n    if (parts.length !== 3) return null;\n    const payload = atob(parts[1].replace(/-/g, '+').replace(/_/g, '/'));\n    return JSON.parse(payload);\n  } catch (e) {\n    return null;\n  }\n}\n\nexport async function renderLogin() {\n  const container = document.getElementById('app')!;\n\n  container.innerHTML = `\n    <div class=\"login-page\">\n      <div class=\"login-card glass-card\">\n        <header class=\"login-header text-center\">\n          <img src=\"/CodeNinjasLogo.svg\" alt=\"Code Ninjas\" class=\"login-logo impact-logo\" />\n          <h1 class=\"login-brand\">NinjaBux</h1>\n        </header>\n\n        <form id=\"login-form\" class=\"login-form\">\n          <input\n            type=\"text\"\n            id=\"cn-username\"\n            name=\"cn-username\"\n            class=\"login-input\"\n            placeholder=\"Username\"\n            aria-label=\"Username\"\n            autocomplete=\"username\"\n            required\n          />\n\n          <button type=\"submit\" class=\"btn btn-green\" id=\"login-submit\">Log In</button>\n        </form>\n\n        <div id=\"login-status\" class=\"login-status\"></div>\n      </div>\n    </div>\n  `;\n\n  const form = document.getElementById('login-form') as HTMLFormElement;\n  const usernameInput = document.getElementById('cn-username') as HTMLInputElement;\n  const statusEl = document.getElementById('login-status') as HTMLDivElement;\n  // Default fallback coordinates (used when geolocation unavailable over HTTP)\n  const DEFAULT_LAT = 0;\n  const DEFAULT_LON = 0;\n\n  let cachedLat: number | null = null;\n  let cachedLon: number | null = null;\n  let cachedToken: string | null = null;\n\n  const countStatuses = (node: any): { done: number; total: number } => {\n    let total = 0;\n    let done = 0;\n    const visit = (value: any) => {\n      if (!value || typeof value !== 'object') return;\n      if (Array.isArray(value)) {\n        value.forEach(visit);\n        return;\n      }\n      if (typeof value.status === 'boolean') {\n        total += 1;\n        if (value.status) done += 1;\n      }\n      Object.values(value).forEach(visit);\n    };\n    visit(node);\n    return { done, total };\n  };\n\n  function setStatus(message: string, isError = false) {\n    statusEl.textContent = message;\n    statusEl.style.color = isError ? '#b00020' : '#0b3d91';\n  }\n\n  function requestLocation(): Promise<void> {\n    return new Promise((resolve) => {\n      // Check if we're on a secure origin (HTTPS or localhost)\n      const isSecure = window.location.protocol === 'https:' ||\n                       window.location.hostname === 'localhost' ||\n                       window.location.hostname === '127.0.0.1';\n\n      if (!isSecure) {\n        // Geolocation won't work over HTTP on network - use fallback\n        cachedLat = DEFAULT_LAT;\n        cachedLon = DEFAULT_LON;\n        setStatus('Using default location (HTTP mode)');\n        resolve();\n        return;\n      }\n\n      if (!navigator.geolocation) {\n        cachedLat = DEFAULT_LAT;\n        cachedLon = DEFAULT_LON;\n        setStatus('Geolocation not supported, using default location');\n        resolve();\n        return;\n      }\n\n      setStatus('Requesting location...');\n      navigator.geolocation.getCurrentPosition(\n        pos => {\n          const { latitude, longitude } = pos.coords;\n          cachedLat = latitude;\n          cachedLon = longitude;\n          setStatus('Location acquired.');\n          resolve();\n        },\n        () => {\n          // Use fallback coordinates on error\n          cachedLat = DEFAULT_LAT;\n          cachedLon = DEFAULT_LON;\n          setStatus('Using default location');\n          resolve();\n        },\n        { timeout: 5000 }\n      );\n    });\n  }\n\n  // Request location immediately on page load\n  requestLocation();\n\n  form.addEventListener('submit', async evt => {\n    evt.preventDefault();\n    const user = usernameInput.value.trim();\n\n    if (!user) {\n      setStatus('Please enter your username.', true);\n      return;\n    }\n\n    if (cachedLat === null || cachedLon === null) {\n      await requestLocation();\n    }\n    const latitude = cachedLat ?? DEFAULT_LAT;\n    const longitude = cachedLon ?? DEFAULT_LON;\n\n    setStatus('Logging in...');\n    const loginRes = await post<any>('/cn/login', {\n      user,\n      latitude: Number(latitude),\n      longitude: Number(longitude),\n    });\n\n    if (loginRes.error || !loginRes.data) {\n      setStatus(`Login failed: ${loginRes.error || 'unknown error'}`, true);\n      return;\n    }\n\n    let loginData = loginRes.data as any;\n    if (typeof loginData === 'string') {\n      try {\n        loginData = JSON.parse(loginData);\n      } catch {\n        // leave as string\n      }\n    }\n\n    const token = loginData.token;\n    if (!token) {\n      setStatus('Login did not return a token.', true);\n      return;\n    }\n    cachedToken = token;\n\n    const claims = decodeJwt(token);\n    const facilityId = claims?.['facilityid'] as string | undefined;\n    const studentId = claims?.['oid'] as string | undefined;\n    if (!facilityId || !studentId) {\n      setStatus('Could not read facility or student ID from token.', true);\n      return;\n    }\n\n    setStatus('Fetching your current activity...');\n    const activityRes = await fetch('/api/cn/activity/current', {\n      headers: { Authorization: `Bearer ${token}` },\n    });\n    if (!activityRes.ok) {\n      const errText = await activityRes.text();\n      setStatus(`Activity fetch failed: ${activityRes.status} ${errText}`, true);\n      return;\n    }\n    const activityData = await activityRes.json();\n    const rel = activityData?.relationShips?.data || {};\n    if (rel.programId) {\n      sessionStorage.setItem('cn_programId', rel.programId);\n    }\n    if (rel.courseId) {\n      sessionStorage.setItem('cn_courseId', rel.courseId);\n    }\n    if (rel.levelId) {\n      sessionStorage.setItem('cn_levelId', rel.levelId);\n    }\n\n    // Get level status to derive level sequence and activity sequence\n    let levelSequence: number | null = null;\n    let activitySequence: number | null = null;\n    let completedSteps: number | null = null;\n    let totalSteps: number | null = null;\n    try {\n      const params = new URLSearchParams({\n        programId: rel.programId || '',\n        courseId: rel.courseId || '',\n      });\n      if (rel.levelId) {\n        params.append('levelId', rel.levelId);\n      }\n      const statusRes = await fetch(`/api/cn/level/statusinfo?${params.toString()}`, {\n        headers: { Authorization: `Bearer ${token}` },\n      });\n      if (statusRes.ok) {\n        const statusData = await statusRes.json();\n        levelSequence = statusData.levelSequence ?? null;\n        completedSteps = statusData.completedSteps ?? null;\n        totalSteps = statusData.totalSteps ?? null;\n\n        // Extract activity sequence from the activitySequences map\n        const currentActivityId = rel.activityId || activityData.id;\n        if (statusData.activitySequences && currentActivityId) {\n          activitySequence = statusData.activitySequences[currentActivityId] ?? null;\n        }\n      }\n    } catch {\n      // ignore\n    }\n\n    // Try group-level status for finer-grained step counts\n    if (rel.programId && rel.courseId) {\n      try {\n        const groupParams = new URLSearchParams({\n          programId: rel.programId,\n          courseId: rel.courseId,\n        });\n        const groupRes = await fetch(`/api/cn/groups/current?${groupParams.toString()}`, {\n          headers: { Authorization: `Bearer ${token}` },\n        });\n        if (groupRes.ok) {\n          const raw = await groupRes.text();\n          let groupData: any;\n          try {\n            groupData = JSON.parse(raw);\n          } catch {\n            groupData = raw;\n          }\n          const { done, total } = countStatuses(groupData);\n          if (total > 0) {\n            completedSteps = done;\n            totalSteps = total;\n          }\n        }\n      } catch {\n        // ignore\n      }\n    }\n\n    setStatus('Saving your profile...');\n    const syncRes = await post<any>(\n      `/facilities/${facilityId}/ninjas/${studentId}/sync-local`,\n      {\n        firstName: loginData.user?.firstName || rel.firstName || '',\n        lastName: loginData.user?.lastName || rel.lastName || '',\n        courseName: rel.courseName || '',\n        levelId: rel.levelId || '',\n        levelSequence: levelSequence,\n        activityId: rel.activityId || activityData.id,\n        activitySequence: activitySequence,\n        groupId: rel.groupId || '',\n        subGroupId: rel.subgroupId || '',\n        completedSteps: completedSteps,\n        totalSteps: totalSteps,\n        lastModifiedDate: activityData.lastModifiedDate || null,\n      }\n    );\n    if (syncRes.error || !syncRes.data) {\n      setStatus(`Sync failed: ${syncRes.error || 'unknown error'}`, true);\n      return;\n    }\n\n    const syncData = syncRes.data as any;\n    const ninjaData = syncData?.changes?.ninja;\n\n    const mappedNinja: Ninja = {\n      id: ninjaData?.id || 0,\n      studentId: ninjaData?.studentId || studentId,\n      firstName: ninjaData?.firstName || loginData.user?.firstName || rel.firstName || '',\n      lastName: ninjaData?.lastName || loginData.user?.lastName || rel.lastName || '',\n      courseName: ninjaData?.courseName || rel.courseName || '',\n      levelName: ninjaData?.levelName || null,\n      levelSequence: ninjaData?.levelSequence ?? levelSequence ?? null,\n      activityId: ninjaData?.activityId || rel.activityId || activityData.id || null,\n      groupId: ninjaData?.groupId || rel.groupId || null,\n      subGroupId: ninjaData?.subGroupId || rel.subgroupId || null,\n      completedSteps: ninjaData?.completedSteps ?? completedSteps ?? null,\n      totalSteps: ninjaData?.totalSteps ?? totalSteps ?? null,\n      currentBalance: ninjaData?.currentBalance ?? 0,\n      lastSyncedAt: ninjaData?.lastSyncedAt || new Date().toISOString(),\n    };\n\n    setState({ facilityId, studentId });\n    // Store token for later calls if needed\n    sessionStorage.setItem('cn_token', cachedToken || '');\n    setCurrentNinja(mappedNinja);\n    navigate('/dashboard');\n  });\n}\n","import { getState, logout } from '../state';\nimport { navigate } from '../router';\n\nexport function renderNavbar(): string {\n  const { currentNinja } = getState();\n  const name = currentNinja ? `${currentNinja.firstName}` : '';\n\n  return `\n    <nav class=\"navbar\">\n      <div class=\"nav-container\">\n        <div class=\"nav-left\">\n          <img src=\"/CodeNinjasLogo.svg\" alt=\"Code Ninjas\" class=\"app-logo\" />\n          <span class=\"app-title\">NinjaBux</span>\n        </div>\n\n        <div class=\"navbar-links\">\n          <a href=\"#/dashboard\" class=\"nav-link\">Dashboard</a>\n          <a href=\"#/shop\" class=\"nav-link\">Shop</a>\n          <a href=\"#/leaderboard\" class=\"nav-link\">Leaderboard</a>\n        </div>\n\n        <div class=\"navbar-right\">\n          <span class=\"nav-user\">${name}</span>\n          <button class=\"btn btn-logout\" id=\"logout-btn\">Logout</button>\n        </div>\n      </div>\n    </nav>\n  `;\n}\n\nexport function attachNavbarHandlers() {\n  const logoutBtn = document.getElementById('logout-btn');\n  if (logoutBtn) {\n    logoutBtn.addEventListener('click', () => {\n      logout();\n      navigate('/');\n    });\n  }\n}\n","import { getState, isLoggedIn, setCurrentNinja } from '../state';\nimport { navigate } from '../router';\nimport { renderNavbar } from '../components/navbar';\nimport type { Ninja, LedgerTxn, TxnType, LedgerResponse } from '../types';\nimport { get } from '../api/client';\n\nfunction getTxnIcon(type: TxnType): string {\n  switch (type) {\n    case 'INITIAL_BALANCE': return '+';\n    case 'ACTIVITY_REWARD': return '+';\n    case 'PURCHASE': return '-';\n    case 'ADJUSTMENT': return '~';\n    default: return '';\n  }\n}\n\nfunction getTxnClass(amount: number): string {\n  if (amount > 0) return 'positive';\n  if (amount < 0) return 'negative';\n  return 'neutral';\n}\n\nfunction formatDate(dateStr: string): string {\n  const date = new Date(dateStr);\n  return date.toLocaleDateString('en-US', {\n    month: 'short',\n    day: 'numeric',\n    hour: 'numeric',\n    minute: '2-digit'\n  });\n}\n\nfunction renderTransactions(transactions: LedgerTxn[]): string {\n  if (transactions.length === 0) {\n    return '<li class=\"empty\">No recent transactions</li>';\n  }\n\n  return transactions.map(txn => `\n    <li class=\"transaction-item ${getTxnClass(txn.amount)}\">\n      <span class=\"transaction-icon\">${getTxnIcon(txn.type)}</span>\n      <div class=\"transaction-details\">\n        <span class=\"transaction-desc\">${txn.description}</span>\n        <span class=\"transaction-date\">${formatDate(txn.createdAt)}</span>\n      </div>\n      <span class=\"transaction-amount\">${txn.amount > 0 ? '+' : ''}${txn.amount}</span>\n    </li>\n  `).join('');\n}\n\nexport async function renderDashboard() {\n  const container = document.getElementById('app')!;\n\n  if (!isLoggedIn()) {\n    navigate('/');\n    return;\n  }\n\n  const { facilityId, studentId, currentNinja } = getState();\n\n  container.innerHTML = `\n    ${renderNavbar()}\n    <main class=\"dashboard-page\">\n      <div class=\"loading\">Loading dashboard...</div>\n    </main>\n  `;\n\n  const mainContainer = container.querySelector('main')!;\n\n  // Always refresh from the backend to ensure latest balance\n  const ninjaRes = await get<Ninja>(`/facilities/${facilityId}/ninjas/${studentId}`);\n  if (ninjaRes.error || !ninjaRes.data) {\n    if (currentNinja) {\n      // Fallback to cached profile\n      renderDashboardContent(mainContainer, currentNinja, null, []);\n      return;\n    }\n    mainContainer.innerHTML = `<div class=\"error\">Failed to load profile. Please log in again.</div>`;\n    return;\n  }\n\n  const ninja = ninjaRes.data;\n  setCurrentNinja(ninja);\n  const progress = await fetchProgress();\n  const ledgerRes = await get<LedgerResponse>(\n    `/facilities/${facilityId}/ninjas/${studentId}/ledger?limit=20`\n  );\n  const txns = ledgerRes.data?.transactions ?? [];\n  renderDashboardContent(mainContainer, ninja, progress, txns);\n}\n\ntype Progress = {\n  totalSteps: number;\n  completedSteps: number;\n  completionPercent: number;\n  nextActivityType?: string | null;\n  nextSequence?: number | null;\n  levelSequence?: number | null;\n} | null;\n\nasync function fetchProgress(): Promise<Progress> {\n  const token = sessionStorage.getItem('cn_token');\n  const programId = sessionStorage.getItem('cn_programId');\n  const courseId = sessionStorage.getItem('cn_courseId');\n  const levelId = sessionStorage.getItem('cn_levelId');\n  if (!token || !programId || !courseId) {\n    return null;\n  }\n  try {\n    const params = new URLSearchParams({\n      programId,\n      courseId,\n    });\n    if (levelId) {\n      params.append('levelId', levelId);\n    }\n    const res = await fetch(`/api/cn/level/statusinfo?${params.toString()}`, {\n      headers: { Authorization: `Bearer ${token}` },\n    });\n    if (!res.ok) return null;\n    const data = await res.json();\n    return {\n      totalSteps: data.totalSteps,\n      completedSteps: data.completedSteps,\n      completionPercent: data.completionPercent,\n      nextActivityType: data.nextActivityType,\n      nextSequence: data.nextSequence,\n      levelSequence: data.levelSequence,\n    };\n  } catch {\n    return null;\n  }\n}\n\nfunction renderDashboardContent(\n  mainContainer: Element,\n  ninja: Ninja,\n  progress: Progress,\n  transactions: LedgerTxn[]\n) {\n  const levelLabel =\n    progress?.levelSequence != null\n      ? `Level ${progress.levelSequence}`\n      : (ninja.levelName || 'Unknown');\n  mainContainer.innerHTML = `\n    <div class=\"dashboard-container\">\n      <div class=\"dashboard\">\n        <header class=\"dashboard-header\">\n          <h1>Welcome, ${[ninja.firstName, ninja.lastName].filter(Boolean).join(' ')}!</h1>\n          <div class=\"ninja-info\">\n            <span class=\"belt-badge belt-${ninja.courseName.toLowerCase().replace(' ', '-')}\">${ninja.courseName}</span>\n            <span class=\"level-badge\">${levelLabel}</span>\n          </div>\n        </header>\n\n        <div class=\"balance-card\">\n          <div class=\"balance-label\">Your Balance</div>\n          <div class=\"balance-amount\">${ninja.currentBalance ?? 0} <span class=\"balance-unit\">Bux</span></div>\n        </div>\n\n        <section class=\"recent-activity\">\n          <h2>Progress</h2>\n          ${\n            progress\n              ? `<div class=\"card\" style=\"padding: 1rem; border-radius: 8px; background: #0f172a; color: white;\">\n                  <div>Completed: ${progress.completedSteps}/${progress.totalSteps} (${progress.completionPercent}%)</div>\n                  <div>Next: ${progress.nextActivityType || 'Unknown'} ${progress.nextSequence || ''}</div>\n                </div>`\n              : '<div class=\"card\" style=\"padding: 1rem; border-radius: 8px; background: #0f172a; color: white;\">Progress data unavailable.</div>'\n          }\n        </section>\n\n        <section class=\"recent-activity\">\n          <h2>Your Ledger</h2>\n          <ul class=\"transaction-list\">\n            ${renderTransactions(transactions)}\n          </ul>\n        </section>\n\n        <div class=\"quick-links\">\n          <a href=\"#/shop\" class=\"btn btn-primary\">Shop</a>\n          <a href=\"#/leaderboard\" class=\"btn btn-secondary\">Leaderboard</a>\n        </div>\n      </div>\n    </div>\n  `;\n}\n","import { get, post } from '../api/client';\nimport { getState, setCurrentNinja, isLoggedIn } from '../state';\nimport { navigate } from '../router';\nimport { renderNavbar } from '../components/navbar';\nimport type { ShopListResponse, ShopItem, PurchaseResponse, Ninja } from '../types';\n\nlet currentBalance = 0;\n\nfunction canAfford(price: number): boolean {\n  return currentBalance >= price;\n}\n\nfunction renderShopItem(item: ShopItem): string {\n  const affordable = canAfford(item.price);\n  const available = item.isAvailable;\n  const canBuy = affordable && available;\n\n  return `\n    <div class=\"shop-item ${!canBuy ? 'disabled' : ''}\" data-item-id=\"${item.id}\">\n      <div class=\"shop-item-icon\">\n        <span class=\"item-placeholder\">${item.name.charAt(0)}</span>\n      </div>\n      <div class=\"shop-item-details\">\n        <h3 class=\"shop-item-name\">${item.name}</h3>\n        <p class=\"shop-item-description\">${item.description}</p>\n      </div>\n      <div class=\"shop-item-footer\">\n        <span class=\"shop-item-price\">${item.price} Bux</span>\n        <button\n          class=\"btn btn-buy ${!canBuy ? 'btn-disabled' : ''}\"\n          ${!canBuy ? 'disabled' : ''}\n          data-item-id=\"${item.id}\"\n          data-item-name=\"${item.name}\"\n          data-item-price=\"${item.price}\"\n        >\n          ${!available ? 'Unavailable' : !affordable ? 'Not enough Bux' : 'Buy'}\n        </button>\n      </div>\n    </div>\n  `;\n}\n\nfunction showPurchaseModal(itemId: number, itemName: string, price: number) {\n  const modal = document.createElement('div');\n  modal.className = 'modal-overlay';\n  modal.innerHTML = `\n    <div class=\"modal\">\n      <h2>Confirm Purchase</h2>\n      <p>Are you sure you want to buy <strong>${itemName}</strong> for <strong>${price} Bux</strong>?</p>\n      <p class=\"modal-balance\">Your balance: ${currentBalance} Bux â†’ ${currentBalance - price} Bux</p>\n      <div class=\"modal-actions\">\n        <button class=\"btn btn-secondary\" id=\"cancel-purchase\">Cancel</button>\n        <button class=\"btn btn-primary\" id=\"confirm-purchase\">Confirm</button>\n      </div>\n    </div>\n  `;\n\n  document.body.appendChild(modal);\n\n  modal.querySelector('#cancel-purchase')!.addEventListener('click', () => {\n    modal.remove();\n  });\n\n  modal.querySelector('#confirm-purchase')!.addEventListener('click', async () => {\n    const { facilityId, studentId } = getState();\n    const confirmBtn = modal.querySelector('#confirm-purchase') as HTMLButtonElement;\n    confirmBtn.disabled = true;\n    confirmBtn.textContent = 'Processing...';\n\n    const res = await post<PurchaseResponse>(`/facilities/${facilityId}/ninjas/${studentId}/purchases`, {\n      shopItemId: itemId\n    });\n\n    if (res.error) {\n      showToast(`Purchase failed: ${res.error}`, 'error');\n      modal.remove();\n      return;\n    }\n\n    currentBalance = res.data!.newBalance;\n    updateBalanceDisplay();\n\n    // Re-render shop items to update button states\n    await refreshShopItems();\n\n    modal.remove();\n    showToast(`Successfully purchased ${itemName}!`, 'success');\n  });\n\n  modal.addEventListener('click', (e) => {\n    if (e.target === modal) {\n      modal.remove();\n    }\n  });\n}\n\nfunction showToast(message: string, type: 'success' | 'error') {\n  const toast = document.createElement('div');\n  toast.className = `toast toast-${type}`;\n  toast.textContent = message;\n  document.body.appendChild(toast);\n\n  setTimeout(() => {\n    toast.classList.add('fade-out');\n    setTimeout(() => toast.remove(), 300);\n  }, 3000);\n}\n\nfunction updateBalanceDisplay() {\n  const balanceEl = document.querySelector('.shop-balance-amount');\n  if (balanceEl) {\n    balanceEl.textContent = `${currentBalance} Bux`;\n  }\n\n  // Update navbar balance\n  const navBalance = document.querySelector('.nav-balance');\n  if (navBalance) {\n    navBalance.textContent = `${currentBalance} Bux`;\n  }\n}\n\nasync function refreshShopItems() {\n  const { facilityId } = getState();\n  const res = await get<ShopListResponse>(`/facilities/${facilityId}/shop`);\n\n  if (res.data) {\n    const grid = document.querySelector('.shop-grid');\n    if (grid) {\n      grid.innerHTML = res.data.items.map(item => renderShopItem(item)).join('');\n      attachBuyHandlers();\n    }\n  }\n}\n\nfunction attachBuyHandlers() {\n  document.querySelectorAll('.btn-buy:not(.btn-disabled)').forEach(btn => {\n    btn.addEventListener('click', (e) => {\n      e.stopPropagation();\n      const target = e.target as HTMLElement;\n      const itemId = parseInt(target.getAttribute('data-item-id')!);\n      const itemName = target.getAttribute('data-item-name')!;\n      const price = parseInt(target.getAttribute('data-item-price')!);\n      showPurchaseModal(itemId, itemName, price);\n    });\n  });\n}\n\nexport async function renderShop() {\n  const container = document.getElementById('app')!;\n\n  if (!isLoggedIn()) {\n    navigate('/');\n    return;\n  }\n\n  const { facilityId, studentId, currentNinja } = getState();\n\n  container.innerHTML = `\n    ${renderNavbar()}\n    <main class=\"shop-page\">\n      <div class=\"loading\">Loading shop...</div>\n    </main>\n  `;\n\n  // Fetch ninja (for balance) and shop items\n  const ninjaRes = currentNinja\n    ? { data: currentNinja, error: undefined }\n    : await get<Ninja>(`/facilities/${facilityId}/ninjas/${studentId}`);\n  const shopRes = await get<ShopListResponse>(`/facilities/${facilityId}/shop`);\n\n  const mainContainer = container.querySelector('main')!;\n\n  if (ninjaRes.error || shopRes.error) {\n    mainContainer.innerHTML = `<div class=\"error\">Failed to load shop</div>`;\n    return;\n  }\n\n  const ninja = ninjaRes.data!;\n  setCurrentNinja(ninja);\n  currentBalance = ninja.currentBalance;\n\n  const items = shopRes.data!.items;\n\n  mainContainer.innerHTML = `\n    <div class=\"shop-container\">\n      <div class=\"shop\">\n        <header class=\"shop-header\">\n          <h1>Shop</h1>\n          <div class=\"shop-balance\">\n            <span class=\"shop-balance-label\">Your Balance:</span>\n            <span class=\"shop-balance-amount\">${currentBalance} Bux</span>\n          </div>\n        </header>\n\n        <div class=\"shop-grid\">\n          ${items.length > 0\n            ? items.map(item => renderShopItem(item)).join('')\n            : '<div class=\"empty\">No items available</div>'\n          }\n        </div>\n      </div>\n    </div>\n  `;\n\n  attachBuyHandlers();\n}\n","import { get } from '../api/client';\nimport { getState, isLoggedIn } from '../state';\nimport { navigate } from '../router';\nimport { renderNavbar } from '../components/navbar';\nimport type { LeaderboardResponse, LeaderboardEntry, LeaderboardPeriod } from '../types';\n\nlet currentPeriod: LeaderboardPeriod = 'weekly';\n\nfunction renderLeaderboardList(entries: LeaderboardEntry[], type: 'earned' | 'spent'): string {\n  if (entries.length === 0) {\n    return '<li class=\"empty\">No data available</li>';\n  }\n\n  const { studentId } = getState();\n\n  return entries.map(entry => {\n    const isCurrentUser = entry.studentId === studentId;\n    const points = type === 'earned' ? entry.pointsEarned : entry.pointsSpent;\n\n    return `\n      <li class=\"leaderboard-entry ${isCurrentUser ? 'current-user' : ''}\">\n        <span class=\"entry-rank\">${entry.rank}</span>\n        <div class=\"entry-info\">\n          <span class=\"entry-name\">${entry.ninjaName}</span>\n        </div>\n        <span class=\"entry-points\">${Math.abs(points || 0)} Bux</span>\n      </li>\n    `;\n  }).join('');\n}\n\nasync function loadLeaderboards() {\n  const { facilityId } = getState();\n\n  const earnedList = document.getElementById('earned-list')!;\n  const spentList = document.getElementById('spent-list')!;\n\n  earnedList.innerHTML = '<li class=\"loading\">Loading...</li>';\n  spentList.innerHTML = '<li class=\"loading\">Loading...</li>';\n\n  const [earnedRes, spentRes] = await Promise.all([\n    get<LeaderboardResponse>(`/facilities/${facilityId}/leaderboard/earned?period=${currentPeriod}`),\n    get<LeaderboardResponse>(`/facilities/${facilityId}/leaderboard/spent?period=${currentPeriod}`)\n  ]);\n\n  if (earnedRes.error) {\n    earnedList.innerHTML = `<li class=\"error\">Failed to load</li>`;\n  } else {\n    earnedList.innerHTML = renderLeaderboardList(earnedRes.data!.leaderboard, 'earned');\n  }\n\n  if (spentRes.error) {\n    spentList.innerHTML = `<li class=\"error\">Failed to load</li>`;\n  } else {\n    spentList.innerHTML = renderLeaderboardList(spentRes.data!.leaderboard, 'spent');\n  }\n}\n\nfunction attachPeriodHandlers() {\n  document.querySelectorAll('.period-tab').forEach(tab => {\n    tab.addEventListener('click', async () => {\n      const period = tab.getAttribute('data-period') as LeaderboardPeriod;\n      if (period === currentPeriod) return;\n\n      currentPeriod = period;\n\n      // Update active tab\n      document.querySelectorAll('.period-tab').forEach(t => t.classList.remove('active'));\n      tab.classList.add('active');\n\n      await loadLeaderboards();\n    });\n  });\n}\n\nexport async function renderLeaderboard() {\n  const container = document.getElementById('app')!;\n\n  if (!isLoggedIn()) {\n    navigate('/');\n    return;\n  }\n\n  container.innerHTML = `\n    ${renderNavbar()}\n    <main class=\"leaderboard-page\">\n      <div class=\"dashboard-container\">\n        <div class=\"leaderboard\">\n          <header class=\"leaderboard-header\">\n            <h1>Leaderboard</h1>\n            <div class=\"period-tabs\">\n              <button class=\"period-tab ${currentPeriod === 'weekly' ? 'active' : ''}\" data-period=\"weekly\">Weekly</button>\n              <button class=\"period-tab ${currentPeriod === 'monthly' ? 'active' : ''}\" data-period=\"monthly\">Monthly</button>\n              <button class=\"period-tab ${currentPeriod === 'yearly' ? 'active' : ''}\" data-period=\"yearly\">Yearly</button>\n            </div>\n          </header>\n\n          <div class=\"leaderboard-columns\">\n            <section class=\"leaderboard-column\">\n              <h2>Top Earners</h2>\n              <ul id=\"earned-list\" class=\"leaderboard-list\">\n                <li class=\"loading\">Loading...</li>\n              </ul>\n            </section>\n\n            <section class=\"leaderboard-column\">\n              <h2>Top Spenders</h2>\n              <ul id=\"spent-list\" class=\"leaderboard-list\">\n                <li class=\"loading\">Loading...</li>\n              </ul>\n            </section>\n          </div>\n        </div>\n      </div>\n    </main>\n  `;\n\n  attachPeriodHandlers();\n  await loadLeaderboards();\n}\n","import { route, initRouter } from './router';\nimport { renderLogin } from './pages/login';\nimport { renderDashboard } from './pages/dashboard';\nimport { renderShop } from './pages/shop';\nimport { renderLeaderboard } from './pages/leaderboard';\nimport { attachNavbarHandlers } from './components/navbar';\nimport './styles/main.scss';\n\n// Register routes\nroute('/', renderLogin);\nroute('/dashboard', async () => {\n  await renderDashboard();\n  attachNavbarHandlers();\n});\nroute('/shop', async () => {\n  await renderShop();\n  attachNavbarHandlers();\n});\nroute('/leaderboard', async () => {\n  await renderLeaderboard();\n  attachNavbarHandlers();\n});\n\n// Initialize router\ninitRouter();\n"],"names":["routes","route","path","handler","paramNames","pattern","_match","paramName","navigate","handleRoute","hash","match","params","name","index","rootRoute","r","initRouter","BASE_URL","get","url","response","error","post","body","loadNinja","raw","state","getState","setState","updates","setCurrentNinja","ninja","logout","isLoggedIn","decodeJwt","token","parts","payload","renderLogin","container","form","usernameInput","statusEl","DEFAULT_LAT","DEFAULT_LON","cachedLat","cachedLon","cachedToken","countStatuses","node","total","done","visit","value","setStatus","message","isError","requestLocation","resolve","pos","latitude","longitude","evt","user","loginRes","loginData","claims","facilityId","studentId","activityRes","errText","activityData","rel","_a","levelSequence","activitySequence","completedSteps","totalSteps","statusRes","statusData","currentActivityId","groupParams","groupRes","groupData","syncRes","_b","_c","syncData","ninjaData","_d","mappedNinja","_e","_f","renderNavbar","currentNinja","attachNavbarHandlers","logoutBtn","getTxnIcon","type","getTxnClass","amount","formatDate","dateStr","renderTransactions","transactions","txn","renderDashboard","mainContainer","ninjaRes","renderDashboardContent","progress","fetchProgress","txns","programId","courseId","levelId","res","data","levelLabel","currentBalance","canAfford","price","renderShopItem","item","affordable","available","canBuy","showPurchaseModal","itemId","itemName","modal","confirmBtn","showToast","updateBalanceDisplay","refreshShopItems","e","toast","balanceEl","navBalance","grid","attachBuyHandlers","btn","target","renderShop","shopRes","items","currentPeriod","renderLeaderboardList","entries","entry","isCurrentUser","points","loadLeaderboards","earnedList","spentList","earnedRes","spentRes","attachPeriodHandlers","tab","period","t","renderLeaderboard"],"mappings":"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"}